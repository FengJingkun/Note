## 重传机制

TCP通过序列号和确认应答实现可靠性传输。针对数据包丢失的情况，TCP会用重传机制解决。

### 超时重传

发送数据时设置一个定时器，超过指定时间仍未收到ACK报文，则重发该数据。

若TCP数据包丢失，或者ACK报文丢失，则触发超时重传机制。

**超时时间RTO(Retransmission TimeOut)的设置**

往返时延RTT(Round-Trip Time)是数据在两端往返的时间，**RTO应该略大于RTT**。

- RTO过大时，过长的重传时间导致效率低下；
- RTO过小时，可能在未丢失的情况下就进行重发，会增加网络堵塞，进而导致更多的超时和重发。

**RTO是一个动态变化的值，要估计RTO时间，需要采样RTT的值并进行加权平均，同时还要采样RTT的波动范围。**

<br>

### 快速重传

发送端连续收到三个确认号相同的ACK报文，则在定时器过期前，立即重传对应序号的报文。

**重传报文时，是重传单个报文，还是重传该报文之后的所有报文？**

<br>

### SACK

为了解决不知道该重传哪些报文，引入了SACK( Selective Ackonwledgement 选择确认 )重传机制。

**接收端在TCP首部的可选字段添加SACK选项，并填入当前已缓存的报文序号。发送端据此确定丢失报文。**

通信双方必须全部支持SACK，可通过内核参数**net.ipv4.tcp_sack**打开该功能。

<br>

### Duplicate-SACK

接收端使用SACK选项告诉发送端收到了哪些重复报文。

**ACK报文丢失**

发送端未接收到ACK，超时重传相应数据包X；接收端发现收到重复的数据包，于是在ACK报文首部添加SACK选项，填入重复报文序号X，并在ACK填入下一个期望接收的报文号。

**数据包延迟**

发送端收到连续三个相同的ACK，触发快速重传。当被延迟的数据包到达接收端时，接收端同样触发D-SACK。

因此，使用D-SACK可以：

- 让发送端知道是ACK丢失还是数据包丢失；
- 让发送端知道数据包是否被网络延迟；
- 网络是否复制了发送端的数据包。

<br>

<br>

## 滑动窗口



<br>

<br>

## 流量控制

<br>

<br>

## 拥塞控制

<br>

<br>